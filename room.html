<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Simple Deno Room</title>
</head>

<body>
  Simple Deno Room


  <video controls></video>
  <script>
    const ws = new WebSocket(`wss://${window.location.host}/ws${window.location.pathname}`)
    const videoSrc = decodeURIComponent(window.location.pathname.replace('/room/', ''));
    const video = document.getElementsByTagName('video')[0];
    video.src = videoSrc;

    video.addEventListener('play', () => {
      console.log('ðŸš€ ~ file: room.html ~ line 18 ~ video.addEventListener ~ play')
      ws.send(JSON.stringify({ command: 'play', time: video.currentTime }));
    });

    video.addEventListener('pause', () => {
      console.log('ðŸš€ ~ file: room.html ~ line 23 ~ video.addEventListener ~ pause')
      ws.send(JSON.stringify({ command: 'pause', time: video.currentTime }));
    });

    ws.addEventListener('message', ({ data }) => {
      data = JSON.parse(data);
      console.log('ðŸš€ ~ file: room.html ~ line 28 ~ ws.addEventListener ~ command', data)
      video.currentTime = data.time;
      switch (data.command) {
        case 'play':
          if (video.paused) {
            video.play();
          }
          break;
        case 'pause':
          if (!video.paused) {
            video.pause();
          }
          break;
      }
    })
  </script>
</body>

</html>